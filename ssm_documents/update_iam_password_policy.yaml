---
schemaVersion: '0.3'
description: 'Update IAM Account Password Policy to meet compliance requirements'
assumeRole: '{{ AutomationAssumeRole }}'
parameters:
  AutomationAssumeRole:
    type: String
    description: 'The ARN of the role that allows Automation to perform the actions'
    default: ''
mainSteps:
  - name: UpdatePasswordPolicy
    action: 'aws:executeAwsApi'
    description: 'Updates the IAM account password policy'
    inputs:
      Service: iam
      Api: UpdateAccountPasswordPolicy
      MinimumPasswordLength: ${MinimumPasswordLength}
      RequireSymbols: ${RequireSymbols}
      RequireNumbers: ${RequireNumbers}
      RequireUppercaseCharacters: ${RequireUppercaseCharacters}
      RequireLowercaseCharacters: ${RequireLowercaseCharacters}
      AllowUsersToChangePassword: true
      MaxPasswordAge: ${MaxPasswordAge}
      PasswordReusePrevention: ${PasswordReusePrevention}
    outputs:
      - Name: Response
        Selector: $
        Type: StringMap
%{ if SNSTopicArn != "" ~}
  - name: SendNotification
    action: 'aws:executeAwsApi'
    description: 'Send SNS notification about password policy update'
    inputs:
      Service: sns
      Api: Publish
      TopicArn: '${SNSTopicArn}'
      Subject: 'IAM Password Policy Updated'
      Message: 'The IAM account password policy has been updated to meet compliance requirements.'
%{ endif ~}
